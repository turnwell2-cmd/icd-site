<?php// sp.php - create a new shipment recordinclude __DIR__ . '/includes/db_connect.php';// Collect form fields$customer_name = trim($_POST['customer_name'] ?? '');$origin = trim($_POST['origin'] ?? '');$destination = trim($_POST['destination'] ?? '');$service = trim($_POST['service'] ?? '');$package_content = trim($_POST['package_content'] ?? '');$package_weight = trim($_POST['package_weight'] ?? '');$declared_value = trim($_POST['declared_value'] ?? '');$additional_services = trim($_POST['additional_services'] ?? '');$third_party_account = trim($_POST['third_party_account'] ?? '');$notes = trim($_POST['notes'] ?? '');$email = trim($_POST['email'] ?? '');// Generate a unique tracking numberfunction make_tracking_number() {    $prefix = 'IC';     $random = strtoupper(substr(md5(uniqid((string)mt_rand(), true)), 0, 8));    return $prefix . $random;}$tries = 0;$tracking_number = '';while ($tries < 5) {    $candidate = make_tracking_number();    $stmt = $db->prepare("SELECT COUNT(*) FROM tracking WHERE tracking_number = :t");    $stmt->execute([':t' => $candidate]);    if ((int)$stmt->fetchColumn() === 0) {        $tracking_number = $candidate;        break;    }    $tries++;}if ($tracking_number === '') die("Failed to generate unique tracking number.");// Insert record$stmt = $db->prepare("    INSERT INTO tracking (        tracking_number, customer_name, origin, destination, service, package_content,         package_weight, declared_value, additional_services, third_party_account,         status, notes, email    ) VALUES (        :tracking_number, :customer_name, :origin, :destination, :service, :package_content,         :package_weight, :declared_value, :additional_services, :third_party_account,         :status, :notes, :email    )");$stmt->execute([    ':tracking_number' => $tracking_number,    ':customer_name' => $customer_name,    ':origin' => $origin,    ':destination' => $destination,    ':service' => $service,    ':package_content' => $package_content,    ':package_weight' => $package_weight,    ':declared_value' => $declared_value,    ':additional_services' => $additional_services,    ':third_party_account' => $third_party_account,    ':status' => 'On Standby',    ':notes' => $notes,    ':email' => $email]);?><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Shipment Created</title></head><body><h1>Shipment Created</h1><p>Your tracking number is: <strong><?= htmlspecialchars($tracking_number) ?></strong></p><p><a href="tracking.php">Track a shipment</a> | <a href="admin.php">Admin Dashboard</a></p></body></html>