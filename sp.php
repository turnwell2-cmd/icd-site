<?php// sp.php - create a new shipment and show full confirmationinclude __DIR__ . '/includes/db_connect.php'; // SQLite connection// Collect form fields (adjust names to match your HTML form)$service     = trim($_POST['service'] ?? 'N/A');$package     = trim($_POST['package'] ?? 'N/A');$weight      = trim($_POST['weight'] ?? 'N/A');$declared    = trim($_POST['declared'] ?? 'N/A');$additional  = trim($_POST['additional'] ?? '');$account_no  = trim($_POST['account_no'] ?? '');$status      = 'In our warehouse'; // default starting status$email       = trim($_POST['email'] ?? '');$sender_name = trim($_POST['sender_name'] ?? '');$sender_addr = trim($_POST['sender_addr'] ?? '');$sender_city = trim($_POST['sender_city'] ?? '');$sender_county = trim($_POST['sender_county'] ?? '');$sender_country = trim($_POST['sender_country'] ?? '');$sender_zip = trim($_POST['sender_zip'] ?? '');$receiver_name = trim($_POST['receiver_name'] ?? '');$receiver_addr = trim($_POST['receiver_addr'] ?? '');$receiver_city = trim($_POST['receiver_city'] ?? '');$receiver_county = trim($_POST['receiver_county'] ?? '');$receiver_country = trim($_POST['receiver_country'] ?? '');$receiver_zip = trim($_POST['receiver_zip'] ?? '');// Generate unique tracking numberfunction make_tracking_number() {    $prefix = 'IC';    $random = strtoupper(substr(md5(uniqid((string)mt_rand(), true)), 0, 8));    return $prefix . $random;}// Ensure uniqueness$tries = 0;$tracking_number = '';while ($tries < 5) {    $candidate = make_tracking_number();    $stmt = $db->prepare("SELECT COUNT(*) FROM tracking WHERE tracking_number = :t");    $stmt->execute([':t' => $candidate]);    if ((int)$stmt->fetchColumn() === 0) {        $tracking_number = $candidate;        break;    }    $tries++;}if ($tracking_number === '') die("Failed to generate unique tracking number.");// Insert into SQLite$insert = $db->prepare("INSERT INTO tracking   (tracking_number, service, package, weight, declared_value, additional_services, account_no, status, email,    sender_name, sender_addr, sender_city, sender_county, sender_country, sender_zip,   receiver_name, receiver_addr, receiver_city, receiver_county, receiver_country, receiver_zip,   created_at)   VALUES   (:tracking, :service, :package, :weight, :declared, :additional, :account, :status, :email,   :sname, :saddr, :scity, :scounty, :scountry, :szip,   :rname, :raddr, :rcity, :rcounty, :rcountry, :rzip,   :created)");$insert->execute([    ':tracking' => $tracking_number,    ':service' => $service,    ':package' => $package,    ':weight' => $weight,    ':declared' => $declared,    ':additional' => $additional,    ':account' => $account_no,    ':status' => $status,    ':email' => $email,    ':sname' => $sender_name,    ':saddr' => $sender_addr,    ':scity' => $sender_city,    ':scounty' => $sender_county,    ':scountry' => $sender_country,    ':szip' => $sender_zip,    ':rname' => $receiver_name,    ':raddr' => $receiver_addr,    ':rcity' => $receiver_city,    ':rcounty' => $receiver_county,    ':rcountry' => $receiver_country,    ':rzip' => $receiver_zip,    ':created' => date('Y-m-d H:i:s')]);// Output full confirmation page?><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Shipment Created</title><style>body { font-family: Arial, sans-serif; color: #333; }table { border-collapse: collapse; width: 80%; margin: auto; }td { padding: 5px; vertical-align: top; }h1 { text-align: center; }</style></head><body><h1>Shipment Created</h1><p>Your tracking number is: <strong><?php echo htmlspecialchars($tracking_number); ?></strong></p><h2>Shipment Details</h2><table border="1"><tr><td>Service</td><td><?php echo htmlspecialchars($service); ?></td></tr><tr><td>Package Content</td><td><?php echo htmlspecialchars($package); ?></td></tr><tr><td>Package Weight</td><td><?php echo htmlspecialchars($weight); ?></td></tr><tr><td>Declared Value</td><td><?php echo htmlspecialchars($declared); ?></td></tr><tr><td>Additional Services</td><td><?php echo htmlspecialchars($additional); ?></td></tr><tr><td>Third Party Account Number</td><td><?php echo htmlspecialchars($account_no); ?></td></tr><tr><td>Status</td><td><?php echo htmlspecialchars($status); ?></td></tr><tr><td>Date Sent</td><td><?php echo date('Y-m-d'); ?></td></tr></table><h2>Sender Information</h2><table border="1"><tr><td>Name</td><td><?php echo htmlspecialchars($sender_name); ?></td></tr><tr><td>Address</td><td><?php echo htmlspecialchars($sender_addr); ?></td></tr><tr><td>City</td><td><?php echo htmlspecialchars($sender_city); ?></td></tr><tr><td>County</td><td><?php echo htmlspecialchars($sender_county); ?></td></tr><tr><td>Country</td><td><?php echo htmlspecialchars($sender_country); ?></td></tr><tr><td>Zip</td><td><?php echo htmlspecialchars($sender_zip); ?></td></tr></table><h2>Receiver Information</h2><table border="1"><tr><td>Name</td><td><?php echo htmlspecialchars($receiver_name); ?></td></tr><tr><td>Address</td><td><?php echo htmlspecialchars($receiver_addr); ?></td></tr><tr><td>City</td><td><?php echo htmlspecialchars($receiver_city); ?></td></tr><tr><td>County</td><td><?php echo htmlspecialchars($receiver_county); ?></td></tr><tr><td>Country</td><td><?php echo htmlspecialchars($receiver_country); ?></td></tr><tr><td>Zip</td><td><?php echo htmlspecialchars($receiver_zip); ?></td></tr></table><p><a href="tracking.php">Track a shipment</a> | <a href="admin.php">Admin Dashboard</a></p></body></html>